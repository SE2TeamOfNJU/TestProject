package yyf.swing.graphics;

import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;

import javax.imageio.ImageIO;

public class ChangeGray {
	private BufferedImage image;
	private BufferedImage tImage;

	public void setImage(String filename) throws IOException {
		image = ImageIO.read(new File(filename));
	}

	private int transRGB(int rgb) {
		int alpha = rgb & 0x7f000000;
		int red = (rgb & 0x00ff0000)>>16;
		int green = (rgb & 0x0000ff00)>>8;
		int blue = rgb & 0x000000ff;
		int c=(int)(red * 0.299 + green * .587 + blue * 0.114);
		return alpha | c<<8|c<<16|c;
	}

	public void getGrayImage() {
		BufferedImage bufferedImage = new BufferedImage(image.getWidth(),
				image.getHeight(), BufferedImage.TYPE_INT_ARGB);
//		System.out.println("width=" + bufferedImage.getWidth() + ",height="
//				+ bufferedImage.getHeight());
		System.out.println(image.getWidth()+"  "+image.getHeight());
		for (int i = 0; i < image.getWidth(); i++)
			for (int j = 0; j < image.getHeight(); j++) {
				bufferedImage.setRGB(i, j, transRGB(image.getRGB(i, j)));

			}
		tImage = bufferedImage;
	}

	public void writeImage(String filename) throws IOException {
		ImageIO.write(tImage, "png", new File(filename));
	}

	public static void main(String[] args) throws IOException {
		ChangeGray ch = new ChangeGray();
		ch.setImage("images/444.jpg");
		ch.getGrayImage();
		ch.writeImage("images/555.png");
	}

}
